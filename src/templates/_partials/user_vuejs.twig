<script>

var app = new Vue({
    el: '#profilePage',
    components: {    
    },
    computed: {
        
    },
    delimiters: ['%%','%%'],
    data: { 
        firstnameOriginal: "{{ user.firstname }}",
        firstname: "{{ user.firstname }}",
        lastnameOriginal: "{{ user.lastname }}",
        lastname: "{{ user.lastname }}",       
        usernameOriginal: "{{ user.username }}",
        username: "{{ user.username }}",
        usernameNew: "",
        usernameAvailable: false,
        emailOriginal: "{{ user.email }}",
        email: "{{ user.email }}",
        password: "",           
        showUsernameChange: false,  
        usernameAvailable: false,
        showChangePassword: false,
        usernameValidated: false,
    },    
    methods: {    
        validateUsername: function() {
            let expr = /^[a-z]{6,}$/gm
            if (expr.test(this.usernameNew)) {
                document.getElementById("username").style.border = "black 1px solid"
                this.usernameValidated = true;                       
            } else {
                document.getElementById("username").style.border = "red 1px solid"
                this.usernameValidated = false;
            }

            if (this.usernameNew !== this.username) {
                this.usernameAvailable = false;
            }         
        },
        checkIfUsernameExists() {
                        
            payload = {
                "username" : this.usernameNew
            }    
            axios.post("{{ site_url }}user/check-username/",payload).then(response => {                
                if (response.data.success === false) {
                    if (response.data.message === "logout") {
                        location.href = "{{ site_url }}logout";
                    }
                } else {
                    if (response.data.message === "unique") {
                        this.usernameAvailable = true;
                        this.username = this.usernameNew
                    } else {
                        this.usernameAvailable = false;
                        this.username = this.usernameOriginal
                    }
                }
            })

        },
    },    
})

</script>